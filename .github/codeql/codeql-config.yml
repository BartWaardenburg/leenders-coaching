name: 'Next.js TypeScript Security Analysis'

# Disable default queries and use custom query suites
disable-default-queries: false

# Include custom queries for Next.js specific issues
queries:
  # Include standard security and quality queries
  - uses: security-extended
  - uses: security-and-quality

  # Include custom queries for broken links and Next.js specific issues
  - uses: ./.github/codeql/custom-queries/broken-links.ql
  - uses: ./.github/codeql/custom-queries/taint-broken-links.ql
  - uses: ./.github/codeql/custom-queries/nextjs-security.ql
  - uses: ./.github/codeql/custom-queries/typescript-best-practices.ql
  - uses: ./.github/codeql/custom-queries/comprehensive-security.ql

# Paths to include in analysis
paths:
  - 'packages/leenders-coaching-nl/src/**'
  - 'packages/studio-leenders-coaching-nl/src/**'

# Paths to exclude from analysis
paths-ignore:
  - '**/node_modules/**'
  - '**/.next/**'
  - '**/dist/**'
  - '**/build/**'
  - '**/coverage/**'
  - '**/*.test.ts'
  - '**/*.test.tsx'
  - '**/*.spec.ts'
  - '**/*.spec.tsx'
  - '**/__tests__/**'
  - '**/test/**'
  - '**/storybook/**'
  - '**/.storybook/**'

# Threat models to include
# - remote: Network requests and responses
# - local: Local files, command-line args, environment variables
threat-models:
  - remote
  - local

# Query filters to reduce false positives and focus on relevant issues
query-filters:
  # Include security-related queries
  - include:
      tags contain: security
  - include:
      tags contain: external
  - include:
      tags contain: cwe
  # Exclude experimental and low-precision queries
  - exclude:
      tags contain: experimental
  - exclude:
      precision: very-low
  # Focus on high-impact security issues for Next.js
  - include:
      tags contain: 'cwe/cwe-079' # XSS
  - include:
      tags contain: 'cwe/cwe-089' # SQL Injection
  - include:
      tags contain: 'cwe/cwe-078' # Command Injection
  - include:
      tags contain: 'cwe/cwe-022' # Path Traversal
  - include:
      tags contain: 'cwe/cwe-601' # Open Redirect
  - include:
      tags contain: 'cwe/cwe-918' # SSRF
  - include:
      tags contain: 'cwe/cwe-312' # Clear Text Storage
  - include:
      tags contain: 'cwe/cwe-352' # CSRF
  - include:
      tags contain: 'cwe/cwe-770' # Missing Rate Limiting
  - include:
      tags contain: 'cwe/cwe-327' # Weak Crypto
  - include:
      tags contain: 'cwe/cwe-502' # Deserialization
  - include:
      tags contain: 'cwe/cwe-400' # Resource Exhaustion

# Custom data extensions for better analysis
extensions:
  - ./.github/codeql/data-extensions.yml
